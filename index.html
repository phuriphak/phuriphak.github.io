<button id="generate-link">สร้างลิงก์เชิญเพื่อน</button>
<div id="qrcode"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/+esm"></script>
<script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient('https://qddlkalznhlyuhpxlxxc.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkZGxrYWx6bmhseXVocHhseHhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA4ODU3NjksImV4cCI6MjA1NjQ2MTc2OX0.MN7POFGN967nOr616tRI5l3Z1kXSsXOY5HwegUfZ7eE');

    // ฟังก์ชันสร้าง Referral Code
    function generateReferralCode() {
        return Math.random().toString(36).substr(2, 8).toUpperCase();
    }

    document.getElementById("generate-link").addEventListener("click", async () => {
        const referralCode = generateReferralCode();
        
        // สร้าง Referral Link
        const inviteLink = `https://line.me/R/ti/p/@603ihumd?ref=${referralCode}`
;
        
        // บันทึก Referral Code ลงใน Supabase
        await supabase.from('referrals').insert([{ referral_code: referralCode }]);
        
        // แสดงลิงก์และสร้าง QR Code
        document.getElementById('qrcode').innerHTML = '';
        QRCode.toCanvas(inviteLink, { width: 200 }, (err, canvas) => {
            if (!err) document.getElementById('qrcode').appendChild(canvas);
        });
    });
</script>
