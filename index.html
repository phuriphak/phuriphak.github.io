<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
    const liffId = '2006986037-JozP7wKE';

    // ตรวจสอบการเชื่อมต่อและการ login
    function initLiff() {
        liff.init({ liffId }).then(() => {
            if (liff.isLoggedIn()) {
                getProfile();
            } else {
                liff.login(); // ถ้ายังไม่ได้ login จะให้ login
            }
        }).catch(err => {
            console.error('LIFF initialization error:', err);
        });
    }

    // ดึงข้อมูลโปรไฟล์ของผู้ใช้
    function getProfile() {
        liff.getProfile().then(profile => {
            const userId = profile.userId;
            console.log('User Profile:', profile);

            // สร้าง Referral Link
            const referralCode = generateReferralCode();
            const referralLink = `https://line.me/R/ti/p/@603ihumd?ref=${referralCode}`;
            console.log('Referral Link:', referralLink);

            // สร้าง QR Code (ใช้ QRCode.js)
            QRCode.toCanvas(referralLink, { width: 200 }, (err, canvas) => {
                if (!err) {
                    document.getElementById('qrcode').appendChild(canvas);
                }
            });

            // บันทึกข้อมูลใน Supabase หรือทำสิ่งที่ต้องการ
        }).catch(error => {
            console.error('Error fetching profile:', error);
        });
    }

    // ฟังก์ชันสร้าง Referral Code
    function generateReferralCode() {
        return Math.random().toString(36).substr(2, 8).toUpperCase();
    }

    // เรียกฟังก์ชันเริ่มต้น
    initLiff();
</script>
