document.getElementById("generate-link").addEventListener("click", async () => {
    await liff.init({ liffId: "2006986037-JozP7wKE" });
    if (!liff.isLoggedIn()) { liff.login(); return; }

    const profile = await liff.getProfile();
    const userId = profile.userId;
    const referralCode = Math.random().toString(36).substr(2, 8).toUpperCase();

    await supabase.from("referrals").insert([{ referrer_id: userId, referral_code: referralCode }]);

    const inviteLink = `https://line.me/R/ti/p/@603ihumd?ref=${referralCode}`;
    document.getElementById("invite-link").innerText = inviteLink;

    // สร้าง QR Code
    document.getElementById("qrcode").innerHTML = "";
    QRCode.toCanvas(inviteLink, { width: 200 }, (err, canvas) => {
        if (!err) document.getElementById("qrcode").appendChild(canvas);
    });
});
